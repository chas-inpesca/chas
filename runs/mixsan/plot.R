rm(list=ls())
wd= getwd()
setwd(wd)
source("../../R/read.admb.R")
source("../../R/FunctionMixSAN.R")
# setwd("~/ADMwork/MixSan2013/MixSANIFOPv2/")
# Con fecha 10 jul 2017 mixchas trabaja.

san <- read.admb("om")
pdf("om.pdf")
names(san)
#Biomasa
#quartz()
.plotBiomasa(san,leyenda=TRUE)
#quartz()
.plotDesovante(san,leyenda=TRUE)
#quartz()
.plotSelecYearly(san,"flota","sardina")
#quartz()
.plotSelecYearly(san,"flota","anchoveta")
#quartz()
par(mfrow=c(1,2))
.plotReclutas(san,spp="sardina")
.plotReclutas(san,spp="anchoveta")

#quartz()
par(mfrow=c(1,2))
#.plotSR(san,"anchoveta")
#.plotSR(san,"sardina")
library(reshape)
library(lattice)
#quartz()
#.plotCatage(san,type="Captura",spp="Anchoveta")
#quartz()
#.plotCatage(san,type="Captura",spp="Sardina")
#quartz()
.plotCatage(san,type="Reclas",spp="Sardina")
#quartz()
.plotCatage(san,type="Reclas",spp="Anchoveta")
#quartz()
.plotCatage(san,type="Pelaces",spp="Sardina")
#quartz()
.plotCatage(san,type="Pelaces",spp="Anchoveta")



#quartz()
par(mfrow=c(1,1))
plot(san$years,san$t_obs_catch,ylim=c(0,2e6),ylab="Captura",xlab="Año")
lines(san$years,san$pred_catch,col=2)
points(san$years,san$s_obs_catch,pch=2)
lines(san$years,san$s_pred_catch,col=3)
points(san$years,san$a_obs_catch,pch=3)
lines(san$years,san$a_pred_catch,col=4)
#quartz()
par(mfrow=c(3,1))
plot(san$yrs_reclas,san$t_obs_reclas/1000,ylim=c(0,max(san$t_obs_reclas/1000)*1.2),ylab="Biomasa [1000 t]",xlab="Años",main="Total")
lines(san$yrs_reclas,san$t_pred_reclas/1000)
plot(san$yrs_reclas,san$s_obs_reclas/1000,pch=2,ylim=c(0,max(san$t_obs_reclas/1000)*1.2),ylab="Biomasa [1000 t]",xlab="Años",main="Sardina")
lines(san$yrs_reclas,san$s_pred_reclas/1000,lty=2)
plot(san$yrs_reclas,san$a_obs_reclas/1000,pch=3,ylim=c(0,max(san$t_obs_reclas/1000)*1.2),ylab="Biomasa [1000 t]",xlab="Años",main="Anchoveta")
lines(san$yrs_reclas,san$a_pred_reclas/1000,lty=3)

#quartz()
par(mfrow=c(3,1))
plot(san$yrs_pel,san$t_obs_pel/1000,ylim=c(0,max(san$t_obs_pel/1000)*1.2),ylab="Biomasa [1000 t]",xlab="Años",main="Total")
lines(san$yrs_pel,san$t_pred_pelaces/1000)
plot(san$yrs_pel,san$s_obs_pel/1000,ylim=c(0,max(san$t_obs_pel/1000)*1.2),pch=2,ylab="Biomasa [1000 t]",xlab="Años",main="Sardina")
lines(san$yrs_pel,san$s_pred_pelaces/1000,lty=2)
plot(san$yrs_pel,san$a_obs_pel/1000,ylim=c(0,max(san$t_obs_pel/1000)*1.2),pch=3,ylab="Biomasa [1000 t]",xlab="Años",main="Anchoveta")
lines(san$yrs_pel,san$a_pred_pelaces/1000,lty=3)

#Mortalidad por pesca
#quartz()
par(mfrow=c(1,1))
plot(san$years,san$s_Fmort,type="l",ylim=c(0,2),ylab="Mortalidad por pesca",xlab="Años")
lines(san$years,san$a_Fmort,col=4)
legend("topleft",c("sardina","anchoveta"),col=c("black","blue"),lty=c(1,1))

#plot(san$s_pcap,san$a_Fmort,type="b")
plot(san$years,san$prop,type="b",ylim=c(0,1),xlab="Años",ylab="Proporción de sardina común",axes=F,cex.axis=1.2,cex.lab=1.6)
axis(side=1,labels=T)
axis(side=2,labels=T)
abline(h=0.5,lty=2)
abline(h=0.75,lty=2,lwd=0.5)
abline(h=0.25,lty=2,lwd=0.5)
pcap <- san$s_obs_catch/san$t_obs_catch
lines(san$years,pcap,col=1,type="b",pch=15)
legend(1990,0.95,legend=c("Prop. reclutas","Prop. capturas"),pch=c(1,15),lty=c(1,1))

san$prop<-san$s_biom/(san$biomass)
pcap<-san$s_obs_catch/san$t_obs_catch
#postscript("Fig_2.eps",height = 8, width = 10) #tamaño es en pulgadas
plot(san$prop,pcap,type="b",ylim=c(0,1),xlim=c(0,1),xlab="Proporción Biomasa - sardina",ylab="Proporción Captura - sardina",axes=F,cex=1.2,cex.axis=1.2,cex.lab=1.6)
axis(side=1,labels=T)
axis(side=2,labels=T)
m0 <- lm(pcap~san$prop-1)
abline(m0)
#x1 <- san$prop
x <- seq(0,1,0.01)
#pest<- m1$coeff[1]*x+m1$coeff[2]*x^2+m1$coeff[3]*x^3
#lines(x,pest,lty=2,lwd=2)
pest2<-2.5*x-4.5*x^2+3*x^3
lines(x,pest2,col=1,lwd=2)
abline(v=0.5,lty=2,col=1,lwd=0.5)
abline(v=0.75,lty=2,col=2,lwd=0.5)
abline(v=0.25,lty=2,col=2,lwd=0.5)
abline(h=0.5,lty=2,col=1,lwd=0.5)
abline(h=0.75,lty=2,col=2,lwd=0.5)
abline(h=0.25,lty=2,col=2,lwd=0.5)
legend(0,1,legend=c("Observado","lineal","Modelo Operante"),lty=c(NA,1,2,1),col=c(1,1,1),pch=c(1,NA,NA),lwd=c(1,1,2))
#dev.off()


dev.off()
